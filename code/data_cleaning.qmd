---
output: html_document
editor_options: 
  chunk_output_type: console
---
Loading up the library
```{r}
library(tidyverse)
library(viridis)
library(janitor)
```

Read in the orginal data
```{r}
nursing <- read_csv("data/De-Identified Informatics Competency Assessment for June 2024 Faculty  (Responses) - Form Responses 1.csv") |> 
  clean_names()
```

changing some data table name
```{r}
new_names <- c("timestamp", "email_adress", "score", "current_role", "different_role", "teaching_informatics", "informatics_role_in_healthcare", "years_of_teaching_in_higher_education", "rank", "gender", "education_level", "ethnicity", "communication_technologies_in_healthcare_q1", "implement_health_information_technologies_q2", "deliver_care_q3", "workflow_processes_patient_client_outcomes_q4", "gather_generate_document_identify_q5", "entering_accurate_data_q6", "how_data_moves_q7", "identify_appropriate_data_q8", "describe_standardized_data_q9", "generate_information_knowledge_q10", "use_standardized_data_q11", "find_interpret_primary_and_secondary_data_q12", "use_appropriate_information/communication_technologies_q13", "understand_decision_support_tools_q14", "identify_emerging_technologies_q15", "impact_on_quality_safe_care_q16", "address_patients_needs_and_care_gaps_q17", "unexpected_consequences_of_implementation_q18", "how_data_is_exchanged_q19", "the_latest_legal_and_regulatory_requirements_q20", "patients_right_to_access_review_correct_q21")

nursing_new <- nursing

names(nursing_new) <- new_names
```

```{r}
na_counts <- nursing_new %>%
  summarise(across(everything(), ~ sum(is.na(.), na.rm = TRUE)))
print(na_counts)
```


Data mutation and manipulation
```{r}
nursing_new <- nursing_new |> 
  mutate(current_role = case_when(current_role %in% c("Adjunct Faculty", "Adjunct faculty (TUG/ELM)", "Professor Emerita, Adjunct Faculty", "adjunct faculty", "adjunct instructor")~"Adjunct Faculty",
                                  current_role %in% c("Faculty", "Faculty, Chair or Program")~"Faculty",
                                  current_role %in% c("Graduate Student", "Graduate Student, Faculty")~"Graduate Student",
                                  current_role %in% c("Under Graduate Student")~"Under Graduate Student"))

nursing_new<-nursing_new |> 
  mutate(rank = case_when(rank %in% c("Instuctor", "Instuctor, Lecturer")~"Instuctor", 
                          rank %in% c("Associate Professor", "Lecturer, Assistant Professor, Associate Professor")~"Associate Professor",
                          TRUE ~ rank))

```

```{r}
nursing_new |> 
  mutate(case_when)
```


EDA: Interaction
```{r}
nursing_long <-nursing_new |> 
  select(generate_information_knowledge_q10:patients_right_to_access_review_correct_q21) |> 
  drop_na() |> 
  pivot_longer(cols = everything(), names_to = "question", values_to = "response")

ggplot(nursing_long, aes(y = question, fill = response)) +
  geom_bar(position = "fill") +
  labs(x = "Proportion",
       title = "Survey Questions and Answers",
       y = "",
       fill = "") +
  theme_minimal()+
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank())+
  scale_fill_viridis_d()
```
Table for interaction
```{r}
proportion_table <- nursing_long |> 
  group_by(question, response) |> 
  summarise(count = n(), .groups = 'drop') |> 
  #calculate total count for each question
  group_by(question) |> 
  mutate(total = sum(count),
         proportion = count / total) |> 
  ungroup() |> 
  select(question, response, count, proportion) |> 
  #Reshape the table
  pivot_wider(names_from = response, values_from = c(count, proportion), values_fill = 0) |> 
  clean_names()

prortion_table_test <- proportion_table |> 
  mutate(
    Adequate_knowledge = paste(count_adequate_knowledge_adequate_skill_could_teach, sprintf("(%0.2f)", as.numeric(proportion_adequate_knowledge_adequate_skill_could_teach))),
    Excellent_knowledge = paste(count_excellent_very_knowledgeable_skilled_comfortable_to_teach, sprintf("(%0.2f)", as.numeric(proportion_excellent_very_knowledgeable_skilled_comfortable_to_teach))),
    Minimal_knowledge = paste(count_minimal_knowledge_minimal_skill, sprintf("(%0.2f)", as.numeric(proportion_minimal_knowledge_minimal_skill))),
    Moderate_knowledge = paste(count_moderate_knowledge_some_skill, sprintf("(%0.2f)", as.numeric(proportion_moderate_knowledge_some_skill))),
    No_knowledge = paste(count_no_knowledge_no_skill_unable_to_teach, sprintf("(%0.2f)", as.numeric(proportion_no_knowledge_no_skill_unable_to_teach)))
  ) |> 
  select(question, Excellent_knowledge, Adequate_knowledge, Moderate_knowledge, Minimal_knowledge,No_knowledge)
  

```


EDA: Single variable distribution
```{r}
ggplot(nursing_new, aes(y = current_role)) +
  geom_bar(fill = "navy") +
  labs(x = "Count",
       title = "Current role distribution")

ggplot(nursing_new, aes(y = teaching_informatics)) +
  geom_bar(fill = "navy") +
  labs(x = "Count",
       title = "Teaching informatics")

ggplot(nursing_new, aes(y = rank)) +
  geom_bar(fill = "navy") +
  labs(x = "Count",
       title = "Rank Distribution")


```


